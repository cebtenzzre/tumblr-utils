/*!
 * Source: https://github.com/nex3/npf2html (commit 05d602a0ba7c58d06e68603d91338a734c02ce2c)
 * Built with: esbuild 0.25.10
 *   esbuild src/index.ts --bundle --format=iife --global-name=npf2html --platform=neutral --target=es2020 --outfile=dist/npf2html.iife.js --minify --sourcemap
 *
 * SPDX-License-Identifier: MIT
 *
 * Copyright (c) 2024 Natalie Weizenbaum
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
"use strict";var npf2html=(()=>{var h=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var U=(r,t)=>{for(var e in t)h(r,e,{get:t[e],enumerable:!0})},G=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of N(t))!O.call(r,n)&&n!==e&&h(r,n,{get:()=>t[n],enumerable:!(i=S(t,n))||i.enumerable});return r};var j=r=>G(h({},"__esModule",{value:!0}),r);var Q={};U(Q,{Renderer:()=>f,default:()=>D});function I(r,t,e){let i=`<div class="${r.prefix}-layout-ask">`;return i+="<figure><figcaption>",t.attribution&&(i+=`<a href="${r.escape(t.attribution.blog.url)}">`),i+="<strong>"+r.escape(t.attribution?.blog?.name??"Anonymous")+"</strong> asked:",t.attribution&&(i+="</a>"),i+="</figcaption>"+e+"</figure></div>",i}function c(r){return!!r&&"type"in r}function b(r,t){let e=t.type==="blog"?t.blog.url:t.url,i=`<a class="${r.prefix}-attribution ${r.prefix}-attribution-${t.type}" href="${r.escape(e)}">`;switch(t.type){case"post":case"blog":i+=r.escape(t.blog.name);break;case"link":i+=r.escape(t.url);break;case"app":{let n=t.display_text||t.app_name;n&&(i+=r.escape(n)),t.logo?i+=r.renderImageMedia([t.logo]):n||(i+=r.escape(t.url))}}return i+"</a>"}function w(r,t){let e=`<figure class="${r.prefix}-block-audio">`;if(t.media||!(t.embed_html||t.embed_url)){let i=t.title||t.artist||t.album,n=t.poster||c(t.attribution)||i;t.media?(e+=`<audio controls src="${r.escape(t.media.url)}"></audio>`,n&&(e+="<figcaption>")):e+=`<a href="${r.escape(t.url)}">`,t.poster&&(e+=r.renderImageMedia(t.poster)),t.title&&(e+=`<span class="${r.prefix}-block-audio-title">`+r.escape(t.title)+"</span>"),t.artist&&(t.title&&(e+=" - "),e+=`<span class="${r.prefix}-block-audio-artist">`+r.escape(t.artist)+"</span>"),t.album&&((t.title||t.artist)&&(e+=" on "),e+=`<span class="${r.prefix}-block-audio-album">`+r.escape(t.album)+"</span>"),t.media||(i||(e+=r.escape(t.url)),e+="</a>"),c(t.attribution)&&(t.media||(e+="<figcaption>"),e+=r.renderAttribution(t.attribution),t.media||(e+="</figcaption>")),t.media&&n&&(e+="</figcaption>")}else e+=t.embed_html?t.embed_html:`<iframe src="${r.escape(t.embed_url)}"></iframe>`,c(t.attribution)&&(e+="<figcaption>"+r.renderAttribution(t.attribution)+"</figcaption>");return e+="</figure>",e}function A(r,t){let e=t.media.reduce((n,a)=>n&&n.width>a.width?n:a),i=`<figure class="${r.prefix}-block-image"><a href="${r.escape(e.url)}">`+r.renderImageMedia(t.media,{alt:t.alt_text})+"</a>";return(t.caption||c(t.attribution))&&(i+="<figcaption>",t.caption&&(i+=`<span class="${r.prefix}-block-image-caption">`+r.escape(t.caption)+"</span>"),c(t.attribution)&&(i+=r.renderAttribution(t.attribution)),i+="</figcaption>"),i+="</figure>",i}function K(r){let t={},e=[];for(let i of r){if(i.type==="link"||i.type==="mention"){e.push(i);continue}let n=t[i.type];if(n!==void 0){let a=e[n];if(a&&z(a,i)){e[n]={...a,end:i.end};continue}}t[i.type]=e.length,e.push(i)}return e}function z(r,t){if(r.end!==t.start||r.type!==t.type)return!1;switch(r.type){case"bold":case"italic":case"strikethrough":case"small":return!0;case"link":case"mention":return!1;case"color":return r.hex===t.hex}}function E(r,t){let e=[...t].sort((o,s)=>o.start===s.start?s.end-o.end:o.start-s.start),i=[],n=[],a=0,u=0,d=Math.max(...e.map(o=>o.end));for(;u<d&&a<r.length;){for(;u===e[0]?.start;)i.push({format:e.shift(),start:a,children:[]});let o=i.findIndex(l=>l.format.end===u+1),s=r.charCodeAt(a)>>10===54?2:1;if(o!==-1){let l=[];for(let p=o;p<i.length;p++){let m=i[p];(p===0?n:i[p-1].children).push({...m,end:a+s}),m.format.end>u+1&&l.push({...m,start:a+s})}-i.splice(o),i.push(...l)}a+=s,u++}i.length>0&&n.push({...i[0],end:d});for(let o=1;o<i.length;o++)n[n.length-1].children.push({...i[o],end:d});return n}function $(r,t,e){switch(e.type){case"bold":return`<strong>${t}</strong>`;case"italic":return`<em>${t}</em>`;case"strikethrough":return`<s>${t}</s>`;case"small":return`<small>${t}</small>`;case"link":return`<a href="${r.escape(e.url)}">${t}</a>`;case"mention":return`<a class="${r.prefix}-inline-mention" href="${r.escape(e.blog.url)}">${t}</a>`;case"color":return`<span style="color: ${r.escape(e.hex)}">`+t+"</span>"}}function _(r,t,e){if(!e)return r.escape(t);let i=(n,a,u)=>{let d="",o=n;for(let s of u)d+=r.escape(t.substring(o,s.start))+r.renderInlineFormat(i(s.start,s.end,s.children),s.format),o=s.end;return d+r.escape(t.substring(o,a))};return i(0,t.length,E(t,K(e)))}function R(r,t){let e=`<a class="${r.prefix}-block-link" href="${r.escape(t.url)}">`;return t.poster&&(e+=r.renderImageMedia(t.poster)),e+="<h2>"+r.escape(t.title??t.display_url??t.url)+"</h2>",t.site_name&&(e+=`<p class="${r.prefix}-block-link-site">${r.escape(t.site_name)}</p>`),t.author&&(e+=`<p class="${r.prefix}-block-link-author">${r.escape(t.author)}</p>`),t.description&&(e+=`<p class="${r.prefix}-block-link-description">${r.escape(t.description)}</p>`),e+="</a>",e}function F(r,t,e){let i="<img",n=t.reduce((a,u)=>a&&a.width>u.width?a:u);return i+=` src="${r.escape(n.url)}"`,e?.alt&&(i+=` alt="${r.escape(e.alt)}"`),i+=">",i}function L(r,t){if(t.is_visible===!1)return"";let e=`<a class="${r.prefix}-block-paywall ${r.prefix}-block-paywall-${t.subtype}" href="${r.escape(t.url)}"`;return t.subtype==="divider"&&t.color&&(e+=` style="--${r.prefix}-paywall-color: ${t.color}"`),e+=">",t.subtype!=="divider"&&t.title&&(e+=`<h2>${r.escape(t.title)}</h2>`),t.text&&(e+=`<p>${r.escape(t.text)}</p>`),e+="</a>",e}function M(r,t){let e=`<div class="${r.prefix}-block-poll"><h2>${r.escape(t.question)}</h2><ul>`;for(let i of t.answers)e+=`<li>${r.escape(i.answer_text)}</li>`;return e+="</ul></div>",e}function P(r,t,e){let i=[`${r.prefix}-layout-row`];return t?.mode?.type&&i.push(`${r.prefix}-layout-row-${t?.mode?.type}`),`<div class="${i.join(" ")}">${e}</div>`}function T(r,t){return`<details class="${r.prefix}-layout-truncate"><summary>Keep reading</summary>${t}</details>`}function v(r,t){let e=r.formatText(t.text,t.formatting);switch(t.subtype){case"heading1":return`<h1>${e}</h1>`;case"heading2":return`<h2>${e}</h2>`;case"quirky":return`<p class="${r.prefix}-block-text-quirky">${e}</p>`;case"quote":return`<blockquote class="${r.prefix}-block-text-quote"><p>${e}</p></blockquote>`;case"chat":return`<p class="${r.prefix}-block-text-chat">${e}</p>`;default:return`<p>${e}</p>`}}function V(r,t){let{subtype:e}=t[0],i={indented:"<blockquote>","ordered-list-item":"<ol>","unordered-list-item":"<ul>"}[e];for(let n of t){let a=typeof n=="string";i+=e==="indented"?a?"":"<p>":"<li>",i+=a?n:r.formatText(n.text,n.formatting),i+=e==="indented"?a?"":"</p>":"</li>"}return i+={indented:"</blockquote>","ordered-list-item":"</ol>","unordered-list-item":"</ul>"}[e],i}function q(r,t){let e=`<figure class="${r.prefix}-block-video">`;return t.media?(e+='<video controls src="'+r.escape(t.media?.url??t.url)+'"',t.poster&&(e+=' poster="'+r.escape(t.poster.reduce((i,n)=>i&&i.width>n.width?i:n).url)+'"'),e+="></video>"):t.embed_html?e+=t.embed_html:t.embed_iframe?e+=`<iframe src="${r.escape(t.embed_iframe.url)}" width="${t.embed_iframe.width}" height="${t.embed_iframe.height}"></iframe>`:t.embed_url?e+=`<iframe src="${r.escape(t.embed_url)}"></iframe>`:e+=`<a href="${r.escape(t.url)}">`+r.escape(t.url)+"</a>",c(t.attribution)&&(e+="<figcaption>"+r.renderAttribution(t.attribution)+"</figcaption>"),e+="</figure>",e}var H=[{width:128,height:128,url:"https://assets.tumblr.com/images/anonymous_avatar_128.gif"},{width:96,height:96,url:"https://assets.tumblr.com/images/anonymous_avatar_96.gif"},{width:64,height:64,url:"https://assets.tumblr.com/images/anonymous_avatar_64.gif"},{width:48,height:48,url:"https://assets.tumblr.com/images/anonymous_avatar_48.gif"}],f=class{constructor(t){this.prefix=t?.prefix??"npf",this.askingAvatar=t?.askingAvatar??H}escape(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}formatText(t,e){return _(this,t,e)}renderAskLayout(t,e){return I(this,t,e)}renderAttribution(t){return b(this,t)}renderAudio(t){return w(this,t)}renderImage(t){return A(this,t)}renderInlineFormat(t,e){return $(this,t,e)}renderImageMedia(t,e){return F(this,t,e)}renderLink(t){return R(this,t)}renderPaywall(t){return L(this,t)}renderPoll(t){return M(this,t)}renderRowLayout(t,e){return P(this,t,e)}renderTextNoIndent(t){return v(this,t)}renderTextIndented(t){return V(this,t)}renderTruncateLayout(t){return T(this,t)}renderUnknown(t){return`<p color="font-weight: bold; color: red">Unknown block type "${this.escape(t.type)}"!</p>`}renderVideo(t){return q(this,t)}};function C(r){return r.type==="text"&&(r.subtype==="indented"||r.subtype==="ordered-list-item"||r.subtype==="unordered-list-item")}function J(r){let t=[];for(let e of r?.layout??[])if(e.type==="ask")t.push(e);else for(let i of e.display)i.blocks.length!==1&&t.push(i);return t.map(e=>({layout:e,start:Math.min(...e.blocks),end:Math.max(...e.blocks)+1})).sort((e,i)=>e.start-i.start)}function D(r,t){let e=t?.renderer??new f(t),i="",n=t?.layout?.find(o=>o.type==="rows")?.truncate_after,a,u=J(t),d="";for(let o=0;o<r.length;o++){let s=()=>{let y=r[o],B=y.indent_level??0,x=[y];for(;o<r.length-1;){let g=r[o+1];if(!C(g))break;let k=g.indent_level??0;if(k<B)break;if(k===B){if(g.subtype!==y.subtype)break;o++,x.push(g)}else o++,x.push(s())}return e.renderTextIndented(x)},l,p=r[o];switch(p.type){case"audio":l=e.renderAudio(p);break;case"image":l=e.renderImage(p);break;case"link":l=e.renderLink(p);break;case"paywall":l=e.renderPaywall(p);break;case"poll":l=e.renderPoll(p);break;case"video":l=e.renderVideo(p);break;case"text":C(p)?l=s():l=e.renderTextNoIndent(p);break;default:l=e.renderUnknown(p);break}let m=u[0];m&&o>=m.start?(d+=l,o+1===m.end&&(u.shift(),"type"in m.layout?i+=e.renderAskLayout(m.layout,d):i+=e.renderRowLayout(m.layout,d),d="")):i+=l,o===n&&(a=i.length)}return a!==void 0&&(i=i.substring(0,a)+e.renderTruncateLayout(i.substring(a))),i}return j(Q);})();
//# sourceMappingURL=npf2html.iife.js.map

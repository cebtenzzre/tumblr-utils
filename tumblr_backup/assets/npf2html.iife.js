/*!
 * Source: https://github.com/nex3/npf2html (commit 05d602a0ba7c58d06e68603d91338a734c02ce2c)
 * Built with: esbuild 0.25.10
 *   esbuild src/index.ts --bundle --format=iife --global-name=npf2html --platform=neutral --target=es2020 --outfile=dist/npf2html.iife.js --minify --sourcemap
 *
 * SPDX-License-Identifier: MIT
 *
 * Copyright (c) 2024 Natalie Weizenbaum
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
var npf2html=(()=>{var g=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var U=(r,e,t)=>e in r?g(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var G=(r,e)=>{for(var t in e)g(r,t,{get:e[t],enumerable:!0})},j=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of N(e))!O.call(r,n)&&n!==t&&g(r,n,{get:()=>e[n],enumerable:!(i=S(e,n))||i.enumerable});return r};var K=r=>j(g({},"__esModule",{value:!0}),r);var h=(r,e,t)=>U(r,typeof e!="symbol"?e+"":e,t);var W={};G(W,{Renderer:()=>c,default:()=>D});function I(r,e,t){let i=`<div class="${r.prefix}-layout-ask">`;return i+="<figure><figcaption>",e.attribution&&(i+=`<a href="${r.escape(e.attribution.blog.url)}">`),i+="<strong>"+r.escape(e.attribution?.blog?.name??"Anonymous")+"</strong> asked:",e.attribution&&(i+="</a>"),i+="</figcaption>"+t+"</figure></div>",i}function w(r,e){let t=e.type==="blog"?e.blog.url:e.url,i=`<a class="${r.prefix}-attribution ${r.prefix}-attribution-${e.type}" href="${r.escape(t)}">`;switch(e.type){case"post":case"blog":i+=r.escape(e.blog.name);break;case"link":i+=r.escape(e.url);break;case"app":{let n=e.display_text||e.app_name;n&&(i+=r.escape(n)),e.logo?i+=r.renderImageMedia([e.logo]):n||(i+=r.escape(e.url))}}return i+"</a>"}function b(r,e){let t=`<figure class="${r.prefix}-block-audio">`;if(e.media||!(e.embed_html||e.embed_url)){let i=e.title||e.artist||e.album,n=e.poster||e.attribution||i;e.media?(t+=`<audio controls src="${r.escape(e.media.url)}"></audio>`,n&&(t+="<figcaption>")):t+=`<a href="${r.escape(e.url)}">`,e.poster&&(t+=r.renderImageMedia(e.poster)),e.title&&(t+=`<span class="${r.prefix}-block-audio-title">`+r.escape(e.title)+"</span>"),e.artist&&(e.title&&(t+=" - "),t+=`<span class="${r.prefix}-block-audio-artist">`+r.escape(e.artist)+"</span>"),e.album&&((e.title||e.artist)&&(t+=" on "),t+=`<span class="${r.prefix}-block-audio-album">`+r.escape(e.album)+"</span>"),e.media||(i||(t+=r.escape(e.url)),t+="</a>"),e.attribution&&(e.media||(t+="<figcaption>"),t+=r.renderAttribution(e.attribution),e.media||(t+="</figcaption>")),e.media&&n&&(t+="</figcaption>")}else t+=e.embed_html?e.embed_html:`<iframe src="${r.escape(e.embed_url)}"></iframe>`,e.attribution&&(t+="<figcaption>"+r.renderAttribution(e.attribution)+"</figcaption>");return t+="</figure>",t}function A(r,e){let t=e.media.reduce((n,a)=>n&&n.width>a.width?n:a),i=`<figure class="${r.prefix}-block-image"><a href="${r.escape(t.url)}">`+r.renderImageMedia(e.media,{alt:e.alt_text})+"</a>";return(e.caption||e.attribution)&&(i+="<figcaption>",e.caption&&(i+=`<span class="${r.prefix}-block-image-caption">`+r.escape(e.caption)+"</span>"),e.attribution&&(i+=r.renderAttribution(e.attribution)),i+="</figcaption>"),i+="</figure>",i}function z(r){let e={},t=[];for(let i of r){if(i.type==="link"||i.type==="mention"){t.push(i);continue}let n=e[i.type];if(n!==void 0){let a=t[n];if(a&&E(a,i)){t[n]={...a,end:i.end};continue}}e[i.type]=t.length,t.push(i)}return t}function E(r,e){if(r.end!==e.start||r.type!==e.type)return!1;switch(r.type){case"bold":case"italic":case"strikethrough":case"small":return!0;case"link":case"mention":return!1;case"color":return r.hex===e.hex}}function H(r,e){let t=[...e].sort((o,s)=>o.start===s.start?s.end-o.end:o.start-s.start),i=[],n=[],a=0,u=0,d=Math.max(...t.map(o=>o.end));for(;a<d;){for(;u===t[0]?.start;)i.push({format:t.shift(),start:a,children:[]});let o=i.findIndex(l=>l.format.end===u+1),s=r.charCodeAt(a)>>10===54?2:1;if(o!==-1){let l=[];for(let p=o;p<i.length;p++){let m=i[p];(p===0?n:i[p-1].children).push({...m,end:a+s}),m.format.end>u+1&&l.push({...m,start:a+s})}-i.splice(o),i.push(...l)}a+=s,u++}i.length>0&&n.push({...i[0],end:d});for(let o=1;o<i.length;o++)n.at(-1).children.push({...i[o],end:d});return n}function $(r,e,t){switch(t.type){case"bold":return`<strong>${e}</strong>`;case"italic":return`<em>${e}</em>`;case"strikethrough":return`<s>${e}</s>`;case"small":return`<small>${e}</small>`;case"link":return`<a href="${r.escape(t.url)}">${e}</a>`;case"mention":return`<a class="${r.prefix}-inline-mention" href="${r.escape(t.blog.url)}">${e}</a>`;case"color":return`<span style="color: ${r.escape(t.hex)}">`+e+"</span>"}}function _(r,e,t){if(!t)return r.escape(e);let i=(n,a,u)=>{let d="",o=n;for(let s of u)d+=r.escape(e.substring(o,s.start))+r.renderInlineFormat(i(s.start,s.end,s.children),s.format),o=s.end;return d+r.escape(e.substring(o,a))};return i(0,e.length,H(e,z(t)))}function R(r,e){let t=`<a class="${r.prefix}-block-link" href="${r.escape(e.url)}">`;return e.poster&&(t+=r.renderImageMedia(e.poster)),t+="<h2>"+r.escape(e.title??e.display_url??e.url)+"</h2>",e.site_name&&(t+=`<p class="${r.prefix}-block-link-site">${r.escape(e.site_name)}</p>`),e.author&&(t+=`<p class="${r.prefix}-block-link-author">${r.escape(e.author)}</p>`),e.description&&(t+=`<p class="${r.prefix}-block-link-description">${r.escape(e.description)}</p>`),t+="</a>",t}function F(r,e,t){let i="<img",n=e.reduce((a,u)=>a&&a.width>u.width?a:u);return i+=` src="${r.escape(n.url)}"`,t?.alt&&(i+=` alt="${r.escape(t.alt)}"`),i+=">",i}function L(r,e){if(e.is_visible===!1)return"";let t=`<a class="${r.prefix}-block-paywall ${r.prefix}-block-paywall-${e.subtype}" href="${r.escape(e.url)}"`;return e.subtype==="divider"&&e.color&&(t+=` style="--${r.prefix}-paywall-color: ${e.color}"`),t+=">",e.subtype!=="divider"&&e.title&&(t+=`<h2>${r.escape(e.title)}</h2>`),e.text&&(t+=`<p>${r.escape(e.text)}</p>`),t+="</a>",t}function P(r,e){let t=`<div class="${r.prefix}-block-poll"><h2>${r.escape(e.question)}</h2><ul>`;for(let i of e.answers)t+=`<li>${r.escape(i.answer_text)}</li>`;return t+="</ul></div>",t}function T(r,e,t){let i=[`${r.prefix}-layout-row`];return e?.mode?.type&&i.push(`${r.prefix}-layout-row-${e?.mode?.type}`),`<div class="${i.join(" ")}">${t}</div>`}function M(r,e){return`<details class="${r.prefix}-layout-truncate"><summary>Keep reading</summary>${e}</details>`}function v(r,e){let t=r.formatText(e.text,e.formatting);switch(e.subtype){case"heading1":return`<h1>${t}</h1>`;case"heading2":return`<h2>${t}</h2>`;case"quirky":return`<p class="${r.prefix}-block-text-quirky">${t}</p>`;case"quote":return`<blockquote class="${r.prefix}-block-text-quote"><p>${t}</p></blockquote>`;case"chat":return`<p class="${r.prefix}-block-text-chat">${t}</p>`;default:return`<p>${t}</p>`}}function V(r,e){let{subtype:t}=e[0],i={indented:"<blockquote>","ordered-list-item":"<ol>","unordered-list-item":"<ul>"}[t];for(let n of e){let a=typeof n=="string";i+=t==="indented"?a?"":"<p>":"<li>",i+=a?n:r.formatText(n.text,n.formatting),i+=t==="indented"?a?"":"</p>":"</li>"}return i+={indented:"</blockquote>","ordered-list-item":"</ol>","unordered-list-item":"</ul>"}[t],i}function q(r,e){let t=`<figure class="${r.prefix}-block-video">`;return e.media?(t+='<video controls src="'+r.escape(e.media?.url??e.url)+'"',e.poster&&(t+=' poster="'+r.escape(e.poster.reduce((i,n)=>i&&i.width>n.width?i:n).url)+'"'),t+="></video>"):e.embed_html?t+=e.embed_html:e.embed_iframe?t+=`<iframe src="${r.escape(e.embed_iframe.url)}" width="${e.embed_iframe.width}" height="${e.embed_iframe.height}"></iframe>`:e.embed_url?t+=`<iframe src="${r.escape(e.embed_url)}"></iframe>`:t+=`<a href="${r.escape(e.url)}">`+r.escape(e.url)+"</a>",e.attribution&&(t+="<figcaption>"+r.renderAttribution(e.attribution)+"</figcaption>"),t+="</figure>",t}var J=[{width:128,height:128,url:"https://assets.tumblr.com/images/anonymous_avatar_128.gif"},{width:96,height:96,url:"https://assets.tumblr.com/images/anonymous_avatar_96.gif"},{width:64,height:64,url:"https://assets.tumblr.com/images/anonymous_avatar_64.gif"},{width:48,height:48,url:"https://assets.tumblr.com/images/anonymous_avatar_48.gif"}],c=class{constructor(e){h(this,"prefix");h(this,"askingAvatar");this.prefix=e?.prefix??"npf",this.askingAvatar=e?.askingAvatar??J}escape(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}formatText(e,t){return _(this,e,t)}renderAskLayout(e,t){return I(this,e,t)}renderAttribution(e){return w(this,e)}renderAudio(e){return b(this,e)}renderImage(e){return A(this,e)}renderInlineFormat(e,t){return $(this,e,t)}renderImageMedia(e,t){return F(this,e,t)}renderLink(e){return R(this,e)}renderPaywall(e){return L(this,e)}renderPoll(e){return P(this,e)}renderRowLayout(e,t){return T(this,e,t)}renderTextNoIndent(e){return v(this,e)}renderTextIndented(e){return V(this,e)}renderTruncateLayout(e){return M(this,e)}renderUnknown(e){return`<p color="font-weight: bold; color: red">Unknown block type "${this.escape(e.type)}"!</p>`}renderVideo(e){return q(this,e)}};function C(r){return r.type==="text"&&(r.subtype==="indented"||r.subtype==="ordered-list-item"||r.subtype==="unordered-list-item")}function Q(r){let e=[];for(let t of r?.layout??[])if(t.type==="ask")e.push(t);else for(let i of t.display)i.blocks.length!==1&&e.push(i);return e.map(t=>({layout:t,start:Math.min(...t.blocks),end:Math.max(...t.blocks)+1})).sort((t,i)=>t.start-i.start)}function D(r,e){let t=e?.renderer??new c(e),i="",n=e?.layout?.find(o=>o.type==="rows")?.truncate_after,a,u=Q(e),d="";for(let o=0;o<r.length;o++){let s=()=>{let x=r[o],B=x.indent_level??0,y=[x];for(;o<r.length-1;){let f=r[o+1];if(!C(f))break;let k=f.indent_level??0;if(k<B)break;if(k===B){if(f.subtype!==x.subtype)break;o++,y.push(f)}else o++,y.push(s())}return t.renderTextIndented(y)},l,p=r[o];switch(p.type){case"audio":l=t.renderAudio(p);break;case"image":l=t.renderImage(p);break;case"link":l=t.renderLink(p);break;case"paywall":l=t.renderPaywall(p);break;case"poll":l=t.renderPoll(p);break;case"video":l=t.renderVideo(p);break;case"text":C(p)?l=s():l=t.renderTextNoIndent(p);break;default:l=t.renderUnknown(p);break}let m=u[0];m&&o>=m.start?(d+=l,o+1===m.end&&(u.shift(),"type"in m.layout?i+=t.renderAskLayout(m.layout,d):i+=t.renderRowLayout(m.layout,d),d="")):i+=l,o===n&&(a=i.length)}return a!==void 0&&(i=i.substring(0,a)+t.renderTruncateLayout(i.substring(a))),i}return K(W);})();
//# sourceMappingURL=npf2html.iife.js.map
